<!DOCTYPE html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content="Using a promise chain is a very powerful way to handle asynchronous calls. Especially, when you need to make API calls sequently, where the second call depends on the response of the first call."><title>How to break AngularJS promise chain | David Chin</title><link rel=canonical href="http://davidchin.me/blog/how-to-break-angularjs-promise-chain/"><link rel=stylesheet href="http://fonts.googleapis.com/css?family=Fira+Sans:300,400,700,300italic,400italic,700italic"><link rel=stylesheet href=/css/vendor.306b.css><link rel=stylesheet href=/css/application.85f3.css><link rel=apple-touch-icon sizes=76x76 href=/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=152x152 href=/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=152x152 href=/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon-180x180.png><link rel="shortcut icon" type=image/vnd.microsoft.icon href="/favicon.ico"><script>window.disqus_shortname = "davidchin-blog"</script></head><body itemscope itemtype=http://schema.org/WebPage class=""><header class=global-header><div class=global-header__container><nav class=global-navigation><button id=navicon-button class=navicon-button><i class="navicon-button__icon ion-navicon"></i></button><ul class=global-navigation__menu><li><a href=/blog>Blog</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><a href="/" class=global-header__logo role=banner>David Chin</a></div></header><article itemscope itemtype=http://schema.org/BlogPosting><header class=page-header><div class=page-header__container><h1 itemprop=headline class=page-header__title>How to break AngularJS promise chain</h1></div></header><div class=page-content><div class=content-column><div class=blog-article><p class=blog-article__meta><strong>angularjs</strong> / <span itemprop=datePublished>27 March 2014</span> / <a href=/blog/how-to-break-angularjs-promise-chain/#disqus_thread data-disqus-identifier="/blog/how-to-break-angularjs-promise-chain/">0 Comments</a></p><div itemtype=articleBody><p>Using a promise chain is a very powerful way to handle asynchronous calls. Especially, when you need to make API calls sequently, where the second call depends on the response of the first call. Knowing how to break the promise chain saves you from making unnecessary calls, also giving you the flexibility of executing fallback methods.</p><p>For example, you want to make an API request and set up a chain of promises following the initial call. After receiving the initial response, you want to inspect it and decide what to do next. You want to break the promise chain if certain conditions are met in order to skip subsequent success callbacks. To do something like that, have a look at the following <a href="http://jsfiddle.net/dyfchin/MGPfm/">example</a>:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=c1>// NOTE: 3rd-party REST APIs might change so the example below might not work as intended</span>
<span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>&#39;app&#39;</span><span class=p>,</span> <span class=p>[</span><span class=s1>&#39;ngResource&#39;</span><span class=p>])</span>
  <span class=p>.</span><span class=nx>controller</span><span class=p>(</span><span class=s1>&#39;main&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>$scope</span><span class=p>,</span> <span class=nx>$q</span><span class=p>,</span> <span class=nx>$resource</span><span class=p>)</span> <span class=p>{</span>
    <span class=kd>var</span> <span class=nx>Repo</span>   <span class=o>=</span> <span class=nx>$resource</span><span class=p>(</span><span class=s1>&#39;https://api.github.com/rate_limit&#39;</span><span class=p>),</span>
      <span class=nx>Greeting</span> <span class=o>=</span> <span class=nx>$resource</span><span class=p>(</span><span class=s1>&#39;http://angularjs.org/greet.php&#39;</span><span class=p>,</span>
                 <span class=p>{</span> <span class=nx>callback</span><span class=o>:</span> <span class=s1>&#39;JSON_CALLBACK&#39;</span> <span class=p>},</span>
                 <span class=p>{</span> <span class=nx>get</span><span class=o>:</span> <span class=p>{</span> <span class=nx>method</span><span class=o>:</span> <span class=s1>&#39;JSONP&#39;</span> <span class=p>}</span> <span class=p>});</span>
    
    <span class=nx>Repo</span><span class=p>.</span><span class=nx>get</span><span class=p>().</span><span class=nx>$promise</span>
      <span class=c1>// When API call is successful</span>
      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
        <span class=k>if</span> <span class=p>(</span><span class=nx>response</span><span class=p>.</span><span class=nx>rate</span> <span class=o>&amp;&amp;</span> <span class=nx>response</span><span class=p>.</span><span class=nx>rate</span><span class=p>.</span><span class=nx>limit</span> <span class=o>&gt;</span> <span class=mi>10000</span><span class=p>)</span> <span class=p>{</span>
          <span class=k>return</span> <span class=nx>response</span><span class=p>;</span>
        <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
          <span class=k>return</span> <span class=nx>$q</span><span class=p>.</span><span class=nx>reject</span><span class=p>({</span> <span class=nx>message</span><span class=o>:</span> <span class=s1>&#39;Rejecting this promise&#39;</span> <span class=p>});</span>
        <span class=p>}</span>
      <span class=p>})</span>
    
      <span class=c1>// Next promise in the chain</span>
      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>$scope</span><span class=p>.</span><span class=nx>message</span> <span class=o>=</span> <span class=nx>angular</span><span class=p>.</span><span class=nx>toJson</span><span class=p>(</span><span class=nx>response</span><span class=p>);</span>
        
        <span class=c1>// Make another API call or forward response</span>
        <span class=k>return</span> <span class=nx>Greeting</span><span class=p>.</span><span class=nx>get</span><span class=p>().</span><span class=nx>$promise</span><span class=p>;</span>
      <span class=p>},</span> <span class=kd>function</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>$scope</span><span class=p>.</span><span class=nx>message</span> <span class=o>=</span> <span class=nx>response</span><span class=p>.</span><span class=nx>message</span><span class=p>;</span>
        
        <span class=c1>// Forward rejection</span>
        <span class=k>return</span> <span class=nx>$q</span><span class=p>.</span><span class=nx>reject</span><span class=p>(</span><span class=nx>response</span><span class=p>);</span>
      <span class=p>})</span>
    
      <span class=c1>// Another promise in the chain</span>
      <span class=p>.</span><span class=nx>then</span><span class=p>(</span><span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
        <span class=nx>$scope</span><span class=p>.</span><span class=nx>message2</span> <span class=o>=</span> <span class=s1>&#39;The promise chain was not interrupted&#39;</span><span class=p>;</span>
      <span class=p>},</span> <span class=kd>function</span><span class=p>(</span><span class=nx>response</span><span class=p>)</span> <span class=p>{</span>
        <span class=nx>$scope</span><span class=p>.</span><span class=nx>message2</span> <span class=o>=</span> <span class=s1>&#39;The promise chain was interrupted&#39;</span><span class=p>;</span>
      <span class=p>});</span>
  <span class=p>});</span></code></pre></div><p>Calling <code>$q.reject</code> returns a rejected promise. Returning the rejected promise effectively rejects the current promise (the first <code>then</code> success callback). By forwarding the rejection inside each of the error callbacks until the last, you can prevent subsequent promises from getting resolved. Conversely, not forwarding the rejection would mean that the following promise will still get fulfilled and execute its success callback.</p><p>You can see a <a href="http://jsfiddle.net/dyfchin/5hdPb/3/">live demo</a> here.</p></div></div><div itemtype=comment class=blog-comment><div id=disqus_thread></div><script type=text/javascript>var disqus_identifier = "/blog/how-to-break-angularjs-promise-chain/";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href=http://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></article><footer class=global-footer><div class=global-footer__container><nav class=global-footer-navigation><ul><li><a href=//au.linkedin.com/in/davidchin86 target=_blank>LinkedIn</a></li><li><a href=//github.com/davidchin target=_blank>GitHub</a></li><li><a href=//flickr.com/dyfchin target=_blank>Flickr</a></li><li><a href=/blog>Blog</a></li></ul></nav><aside role=contentinfo class=fine-print-footer><div>&copy; All rights reserved.</div><div>Built with Jekyll, CoffeeScript, SASS &amp; Grunt. View <a href=//github.com/davidchin/davidchin.github.io target=_blank>source</a></div></aside></div></footer><!-- GA --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41589871-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');</script><!-- Disqus --><script>(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());</script><!-- CDN --><script src=https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js></script><!-- Packaged JS --><script src=/js/application.a30a.js></script></body></html>