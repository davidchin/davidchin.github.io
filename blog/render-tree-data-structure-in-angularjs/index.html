<!DOCTYPE html><html><head><meta charset=utf-8><meta name=viewport content="width=device-width,initial-scale=1,maximum-scale=1"><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=description content="I came across a problem where I need to lazily render a navigation menu in a tree structure using AngularJS. The API returns the child pages of a parent page by id. For example, GET `/documents/1` gives you all the subpages of page 1. If you click on one of the subpages, it queries the API again to render its subpages, and so forth."><title>Render tree data structure in AngularJS | David Chin</title><link rel=canonical href="http://davidchin.me/blog/render-tree-data-structure-in-angularjs/"><link rel=stylesheet href="http://fonts.googleapis.com/css?family=Fira+Sans:300,400,700,300italic,400italic,700italic"><link rel=stylesheet href=/css/vendor.306b.css><link rel=stylesheet href=/css/application.f342.css><link rel=apple-touch-icon sizes=76x76 href=/apple-touch-icon-76x76.png><link rel=apple-touch-icon sizes=152x152 href=/apple-touch-icon-120x120.png><link rel=apple-touch-icon sizes=152x152 href=/apple-touch-icon-152x152.png><link rel=apple-touch-icon sizes=180x180 href=/apple-touch-icon-180x180.png><link rel="shortcut icon" type=image/vnd.microsoft.icon href="/favicon.ico"><script>window.disqus_shortname = "davidchin-blog"</script></head><body itemscope itemtype=http://schema.org/WebPage class=""><header class=global-header><div class=global-header__container><nav class=global-navigation><button id=navicon-button class=navicon-button><i class="navicon-button__icon ion-navicon"></i></button><ul class=global-navigation__menu><li><a href=/blog>Blog</a></li><li><a href=/projects>Projects</a></li><li><a href=/about>About</a></li></ul></nav><a href="/" class=global-header__logo>David Chin</a></div></header><article itemscope itemtype=http://schema.org/BlogPosting><header class=page-header><div class=page-header__container><h1 itemprop=headline class=page-header__title>Render tree data structure in AngularJS</h1></div></header><div class=page-content><div class=content-column><div class=blog-article><p class=blog-article__meta><strong>angularjs</strong> / <span itemprop=datePublished>09 May 2015</span> / <a href=/blog/render-tree-data-structure-in-angularjs/#disqus_thread data-disqus-identifier="/blog/render-tree-data-structure-in-angularjs/">0 Comments</a></p><div itemtype=articleBody><p>I came across a problem where I need to lazily render a navigation menu in a tree structure using AngularJS. The API returns the child pages of a parent page by id. For example, GET <code>/documents/1</code> gives you all the subpages of page 1. If you click on one of the subpages, it queries the API again to render its subpages, and so forth.</p><p>The depth of the tree is unknown. The JSON response looks like this:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=p>[</span>
  <span class=p>{</span>
    <span class=nx>id</span><span class=o>:</span> <span class=mi>1</span><span class=p>,</span>
    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Folder&#39;</span><span class=p>,</span>
    <span class=nx>hasChildren</span><span class=o>:</span> <span class=kc>true</span>
  <span class=p>},</span>

  <span class=p>{</span>
    <span class=nx>id</span><span class=o>:</span> <span class=mi>2</span><span class=p>,</span>
    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Folder&#39;</span><span class=p>,</span>
    <span class=nx>hasChildren</span><span class=o>:</span> <span class=kc>true</span>
  <span class=p>},</span>

  <span class=p>{</span>
    <span class=nx>id</span><span class=o>:</span> <span class=mi>3</span><span class=p>,</span>
    <span class=nx>name</span><span class=o>:</span> <span class=s1>&#39;Page&#39;</span><span class=p>,</span>
    <span class=nx>hasChildren</span><span class=o>:</span> <span class=kc>false</span>
  <span class=p>}</span>
<span class=p>]</span></code></pre></div><p>In order to render the tree nodes, I need to parse the data recursively. I decided to apply the composite pattern and create a set of directives to handle the view logic. The directive looks like this:</p><div class=highlight><pre><code class=language-html data-lang=html><span class=nt>&lt;document-tree</span> <span class=na>documents=</span><span class=s>&quot;documents&quot;</span><span class=nt>&gt;&lt;/document-tree&gt;</span></code></pre></div><p>The implementation looks like this:</p><div class=highlight><pre><code class=language-javascript data-lang=javascript><span class=nx>angular</span><span class=p>.</span><span class=nx>module</span><span class=p>(</span><span class=s1>&#39;application&#39;</span><span class=p>)</span>
  <span class=p>.</span><span class=nx>directive</span><span class=p>(</span><span class=s1>&#39;documentTree&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
    <span class=k>return</span> <span class=p>{</span>
      <span class=nx>scope</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>documents</span><span class=o>:</span> <span class=s1>&#39;=&#39;</span>
      <span class=p>},</span>
      <span class=nx>restrict</span><span class=o>:</span> <span class=s1>&#39;E&#39;</span><span class=p>,</span>
      <span class=nx>template</span><span class=o>:</span> <span class=p>[</span>
        <span class=s1>&#39;&lt;ol class=&quot;list-group&quot;&gt;&#39;</span><span class=p>,</span>
          <span class=s1>&#39;&lt;li ng-repeat=&quot;child in documents.children&quot; class=&quot;list-group-item&quot;&gt;&#39;</span><span class=p>,</span>
            <span class=s1>&#39;&lt;document-tree-node child=&quot;child&quot;&gt;&#39;</span><span class=p>,</span>
              <span class=s1>&#39;&lt;a ng-click=&quot;documents.open(child)&quot; href=&quot;javascript:void(0);&quot;&gt;&#39;</span><span class=p>,</span>
                <span class=s1>&#39;&#39;</span><span class=p>,</span>
              <span class=s1>&#39;&lt;/a&gt;&#39;</span><span class=p>,</span>
            <span class=s1>&#39;&lt;/document-tree-node&gt;&#39;</span><span class=p>,</span>
          <span class=s1>&#39;&lt;/li&gt;&#39;</span><span class=p>,</span>
        <span class=s1>&#39;&lt;/ol&gt;&#39;</span>
      <span class=p>].</span><span class=nx>join</span><span class=p>(</span><span class=s2>&quot;&quot;</span><span class=p>)</span>
    <span class=p>};</span>
  <span class=p>})</span>

  <span class=p>.</span><span class=nx>directive</span><span class=p>(</span><span class=s1>&#39;documentTreeNode&#39;</span><span class=p>,</span> <span class=kd>function</span><span class=p>(</span><span class=nx>$interpolate</span><span class=p>,</span> <span class=nx>$compile</span><span class=p>)</span> <span class=p>{</span>
    <span class=k>return</span> <span class=p>{</span>
      <span class=nx>scope</span><span class=o>:</span> <span class=p>{</span>
        <span class=nx>child</span><span class=o>:</span> <span class=s1>&#39;=&#39;</span>
      <span class=p>},</span>
      <span class=nx>restrict</span><span class=o>:</span> <span class=s1>&#39;E&#39;</span><span class=p>,</span>

      <span class=nx>link</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>scope</span><span class=p>,</span> <span class=nx>element</span><span class=p>)</span> <span class=p>{</span>
        <span class=kd>var</span> <span class=nx>treeNode</span> <span class=o>=</span> <span class=p>{</span>
          <span class=nx>init</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
            <span class=c1>// Init any vars</span>
            <span class=nx>scope</span><span class=p>.</span><span class=nx>$watch</span><span class=p>(</span><span class=s1>&#39;child.isExpanded&#39;</span><span class=p>,</span> <span class=k>this</span><span class=p>.</span><span class=nx>toggle</span><span class=p>.</span><span class=nx>bind</span><span class=p>(</span><span class=k>this</span><span class=p>));</span>
          <span class=p>},</span>

          <span class=nx>expand</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
            <span class=k>this</span><span class=p>.</span><span class=nx>domId</span> <span class=o>=</span> <span class=s1>&#39;document-children-&#39;</span> <span class=o>+</span> <span class=nx>scope</span><span class=p>.</span><span class=nx>child</span><span class=p>.</span><span class=nx>id</span><span class=p>;</span>

            <span class=c1>// Insert child documents</span>
            <span class=kd>var</span> <span class=nx>template</span> <span class=o>=</span> <span class=s1>&#39;&lt;document-tree id=&quot;&quot; documents=&quot;child.documents&quot;&gt;&lt;/document-tree&gt;&#39;</span><span class=p>,</span>
                <span class=nx>html</span> <span class=o>=</span> <span class=nx>$interpolate</span><span class=p>(</span><span class=nx>template</span><span class=p>)({</span> <span class=nx>childrenId</span><span class=o>:</span> <span class=k>this</span><span class=p>.</span><span class=nx>domId</span> <span class=p>}),</span>
                <span class=nx>childrenElement</span> <span class=o>=</span> <span class=nx>$compile</span><span class=p>(</span><span class=nx>html</span><span class=p>)(</span><span class=nx>scope</span><span class=p>);</span>

            <span class=c1>// Insert compiled template</span>
            <span class=nx>element</span><span class=p>.</span><span class=nx>append</span><span class=p>(</span><span class=nx>childrenElement</span><span class=p>);</span>
          <span class=p>},</span>

          <span class=nx>collapse</span><span class=o>:</span> <span class=kd>function</span><span class=p>()</span> <span class=p>{</span>
            <span class=c1>// Remove child elements, if needed</span>
            <span class=nx>$</span><span class=p>(</span><span class=s1>&#39;#&#39;</span> <span class=o>+</span> <span class=k>this</span><span class=p>.</span><span class=nx>domId</span><span class=p>).</span><span class=nx>remove</span><span class=p>();</span>
          <span class=p>},</span>

          <span class=nx>toggle</span><span class=o>:</span> <span class=kd>function</span><span class=p>(</span><span class=nx>shouldExpand</span><span class=p>)</span> <span class=p>{</span>
            <span class=k>if</span> <span class=p>(</span><span class=nx>shouldExpand</span><span class=p>)</span> <span class=p>{</span>
              <span class=k>this</span><span class=p>.</span><span class=nx>expand</span><span class=p>();</span>
            <span class=p>}</span> <span class=k>else</span> <span class=p>{</span>
              <span class=k>this</span><span class=p>.</span><span class=nx>collapse</span><span class=p>();</span>
            <span class=p>}</span>
          <span class=p>}</span>
        <span class=p>};</span>

        <span class=c1>// Init</span>
        <span class=nx>treeNode</span><span class=p>.</span><span class=nx>init</span><span class=p>();</span>
      <span class=p>}</span>
    <span class=p>};</span>
  <span class=p>});</span></code></pre></div><p>As you can see, <code>documentTreeNode</code> compiles itself if it has leaf elements. It needs to be compiled manually, otherwise, you will get a recursive compilation error if the recursion is implemented in the template.</p><p>The root <code>documents</code> object is the root of the tree structure, constructed using the data returned by API. The task of communicating with API is delegated to the <code>Documents</code> model. You can see the <a href=http://codepen.io/davidchin/pen/BNjpNr>full code and demo</a> here.</p></div></div><div itemtype=comment class=blog-comment><div id=disqus_thread></div><script type=text/javascript>var disqus_identifier = "/blog/render-tree-data-structure-in-angularjs/";

  /* * * DON'T EDIT BELOW THIS LINE * * */
  (function() {
    var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
    dsq.src = '//' + disqus_shortname + '.disqus.com/embed.js';
    (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
  })();</script><noscript>Please enable JavaScript to view the <a href="http://disqus.com/?ref_noscript">comments powered by Disqus.</a></noscript><a href=http://disqus.com class=dsq-brlink>comments powered by <span class=logo-disqus>Disqus</span></a></div></div></div></article><footer class=global-footer><div class=global-footer__container><nav class=global-footer-navigation><ul><li><a href=//au.linkedin.com/in/davidchin86 target=_blank>LinkedIn</a></li><li><a href=//github.com/davidchin target=_blank>GitHub</a></li><li><a href=//flickr.com/dyfchin target=_blank>Flickr</a></li><li><a href=/blog>Blog</a></li></ul></nav><aside class=fine-print-footer><div>&copy; All rights reserved.</div><div>Built with Jekyll, CoffeeScript, SASS &amp; Grunt. View <a href=//github.com/davidchin/davidchin.github.io target=_blank>source</a></div></aside></div></footer><!-- GA --><script>(function(i,s,o,g,r,a,m){i['GoogleAnalyticsObject']=r;i[r]=i[r]||function(){
  (i[r].q=i[r].q||[]).push(arguments)},i[r].l=1*new Date();a=s.createElement(o),
  m=s.getElementsByTagName(o)[0];a.async=1;a.src=g;m.parentNode.insertBefore(a,m)
  })(window,document,'script','//www.google-analytics.com/analytics.js','ga');

  ga('create', 'UA-41589871-1', 'auto');
  ga('require', 'linkid', 'linkid.js');
  ga('require', 'displayfeatures');
  ga('send', 'pageview');</script><!-- Disqus --><script>(function () {
    var s = document.createElement('script'); s.async = true;
    s.type = 'text/javascript';
    s.src = '//' + disqus_shortname + '.disqus.com/count.js';
    (document.getElementsByTagName('HEAD')[0] || document.getElementsByTagName('BODY')[0]).appendChild(s);
  }());</script><!-- CDN --><script src=https://ajax.googleapis.com/ajax/libs/jquery/2.1.3/jquery.min.js></script><!-- Packaged JS --><script src=/js/application.c54b.js></script></body></html>